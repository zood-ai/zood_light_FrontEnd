import React, { useContext, useEffect, useMemo, useState } from 'react';
import { useForm } from 'react-hook-form';
import { z } from 'zod';
import { zodResolver } from '@hookform/resolvers/zod';

import { Card } from '@/components/ui/card';
import { UserAuthForm } from './components/user-auth-form';
import logo from '/icons/Logo.svg';
import { useNavigate, Link } from 'react-router-dom';
import back from '/icons/arrow-right-circle.svg';
import { Button } from '@/components/custom/button';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { useAuth } from '@/context/AuthContext';
import IconInput from '@/components/custom/InputWithIcon';
import { IconEye, IconEyeOff } from '@tabler/icons-react';

const formSchema = z.object({
  email: z.string().email({ message: 'Invalid email address' }),
  business_reference: z
    .string()
    .min(6, { message: 'ID must be at least 6 characters' }),
  password: z
    .string()
    .min(6, { message: 'Password must be at least 6 characters' }),
});

type AuthFormValues = z.infer<typeof formSchema>;
export default function SignIn2() {
  const navigate = useNavigate();
  const [isLoading, setIsLoading] = useState(false);
  const { login } = useAuth();

  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: '',
      business_reference: '',
      password: '',
    },
  });

  // Handle form submission
  const handleFormSubmit = async (data: AuthFormValues) => {
    setIsLoading(true);

    const x = await login(data);

    if (x === 'success') {
      navigate('/zood-dashboard');
    }
    const timeout = setTimeout(() => {
      setIsLoading(false);
    }, 3000);

    return () => {
      clearTimeout(timeout);
    };
  };
  const [showPassword, setShowPassword] = React.useState(false);

  return (
    <div className="max-h-[100vh] overflow-hidden">
      <div className="flex flex-row  justify-between ms-[140px] me-[103px] mt-[44px]  items-center ">
        <Link to="/">
          <svg
            width={76}
            height={94}
            viewBox="0 0 76 94"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M48.5238 61.7797C50.0542 60.6361 51.4194 59.3208 52.5715 57.7948C56.0729 53.1537 56.8683 47.9545 55.5842 42.3955C54.7171 38.641 52.5904 35.6288 49.7107 33.1142C45.2884 29.2521 40.1198 28.1671 34.4662 29.0972C30.9988 29.6676 28.0324 31.3267 25.4971 33.7582C22.2722 36.8507 20.2606 40.5608 19.9284 45.0584C19.7897 46.9318 19.7652 48.827 20.1473 50.6929C21.0276 54.9997 23.3138 58.4435 26.6652 61.2046C30.5629 64.417 35.1012 65.5209 40.0509 65.0573C43.1429 64.7674 45.9527 63.6531 48.5247 61.7797H48.5238ZM31.6008 82.9542C27.9795 81.0552 24.3894 79.1704 20.7984 77.2885C16.8733 75.2319 12.9228 73.2224 9.03076 71.1044C6.52193 69.739 4.50657 67.7815 2.94221 65.3793C0.862682 62.1876 -0.133677 58.6796 0.0191731 54.876C0.155984 51.4832 1.19669 48.3596 3.1328 45.5654C6.20491 41.1321 10.4781 38.6297 15.7741 37.8195C16.2949 37.7402 16.8243 37.7128 17.4875 37.6486C17.0026 37.387 16.6261 37.1802 16.2478 36.9791C13.8333 35.6968 11.3141 34.5759 9.02226 33.1028C3.25829 29.3975 0.357898 24.0378 0.573021 17.1483C0.726815 12.2418 2.74973 8.10967 6.34077 4.79336C9.24116 2.11444 12.7011 0.573375 16.6355 0.121065C20.7446 -0.351075 24.5375 0.586595 28.1597 2.52614C33.3255 5.29288 38.5356 7.97747 43.7269 10.697C47.4151 12.6299 51.1024 14.5648 54.7897 16.4986C58.7968 18.5997 62.8549 20.61 66.797 22.8272C71.5278 25.4882 74.5707 29.541 75.5585 34.9055C76.9181 42.2841 74.4282 48.2878 68.5265 52.8307C65.8836 54.8647 62.7974 55.9289 59.4677 56.2443C59.2016 56.2698 58.9374 56.3038 58.5402 56.3491C58.7987 56.504 58.9657 56.6154 59.1412 56.7079C61.4916 57.9449 63.8758 59.1215 66.1865 60.4275C70.5814 62.91 73.5734 66.5794 74.8009 71.4954C76.5039 78.314 74.7763 84.2951 69.6842 89.0977C65.2694 93.261 59.8885 94.685 53.9009 93.701C51.9657 93.3828 50.1504 92.6774 48.4134 91.7653C43.0023 88.9239 37.5865 86.092 32.1725 83.2554C31.9914 83.161 31.8121 83.0628 31.6017 82.9504L31.6008 82.9542Z"
              fill="#363088"
            />
            <mask
              id="mask0_1356_8185"
              style={{ maskType: 'luminance' }}
              maskUnits="userSpaceOnUse"
              x={0}
              y={0}
              width={76}
              height={94}
            >
              <path
                d="M48.5199 61.7792C50.0503 60.6357 51.4155 59.3203 52.5676 57.7943C56.069 53.1532 56.8644 47.954 55.5802 42.395C54.7132 38.6406 52.5865 35.6283 49.7068 33.1137C45.2845 29.2516 40.1159 28.1666 34.4623 29.0967C30.9949 29.6671 28.0285 31.3262 25.4932 33.7577C22.2682 36.8502 20.2567 40.5603 19.9245 45.0579C19.7858 46.9313 19.7613 48.8265 20.1434 50.6924C21.0237 54.9993 23.3099 58.443 26.6613 61.2041C30.559 64.4165 35.0973 65.5204 40.047 65.0568C43.139 64.7669 45.9488 63.6526 48.5208 61.7792H48.5199ZM31.5969 82.9537C27.9756 81.0547 24.3855 79.17 20.7945 77.288C16.8694 75.2314 12.9189 73.2219 9.02685 71.1039C6.51802 69.7385 4.50266 67.781 2.9383 65.3788C0.858776 62.1871 -0.137584 58.6791 0.0152669 54.8755C0.152078 51.4828 1.19278 48.3591 3.12889 45.565C6.201 41.1316 10.4742 38.6292 15.7702 37.819C16.291 37.7397 16.8203 37.7123 17.4836 37.6481C16.9987 37.3866 16.6222 37.1798 16.2439 36.9786C13.8294 35.6963 11.3102 34.5754 9.01836 33.1024C3.25438 29.397 0.353992 24.0373 0.569115 17.1478C0.722909 12.2413 2.74582 8.10918 6.33687 4.79287C9.23726 2.11395 12.6972 0.572886 16.6316 0.120577C20.7407 -0.351563 24.5336 0.586106 28.1558 2.52566C33.3216 5.29239 38.5317 7.97698 43.723 10.6965C47.4112 12.6294 51.0985 14.5643 54.7858 16.4982C58.7929 18.5992 62.851 20.6095 66.7931 22.8267C71.5239 25.4877 74.5668 29.5405 75.5546 34.905C76.9142 42.2836 74.4243 48.2873 68.5225 52.8302C65.8797 54.8642 62.7935 55.9284 59.4638 56.2438C59.1977 56.2693 58.9335 56.3033 58.5363 56.3486C58.7948 56.5035 58.9618 56.6149 59.1373 56.7075C61.4876 57.9445 63.8719 59.121 66.1826 60.427C70.5775 62.9095 73.5695 66.5789 74.797 71.4949C76.5 78.3135 74.7724 84.2946 69.6803 89.0972C65.2655 93.2605 59.8846 94.6845 53.897 93.7005C51.9618 93.3823 50.1465 92.6769 48.4095 91.7648C42.9984 88.9234 37.5826 86.0915 32.1686 83.2549C31.9875 83.1605 31.8082 83.0623 31.5978 82.9499L31.5969 82.9537Z"
                fill="white"
              />
            </mask>
            <g mask="url(#mask0_1356_8185)">
              <path
                d="M40.1595 66.2777C43.4873 65.9661 46.5047 64.7631 49.2409 62.7706L47.7973 60.7857C45.3903 62.5393 42.7872 63.5667 39.9311 63.8339L40.1595 66.2786V66.2777ZM25.8802 62.1502C30.0657 65.5997 34.9389 66.7668 40.1595 66.2777L39.9311 63.8329C35.2531 64.2711 31.0507 63.2305 27.4398 60.2551L25.8802 62.1502ZM18.9396 50.936C19.8832 55.5535 22.341 59.2334 25.8802 62.1502L27.4398 60.2551C24.2753 57.6479 22.1599 54.4411 21.3437 50.445L18.9406 50.9369L18.9396 50.936ZM18.7 44.9653C18.5585 46.8794 18.5254 48.9058 18.9396 50.936L21.3428 50.444C20.9946 48.7415 21.0107 46.9776 21.1456 45.1457L18.699 44.9644L18.7 44.9653ZM24.6432 32.87C21.2362 36.1372 19.0576 40.1193 18.7 44.9653L21.1465 45.1466C21.4532 40.9984 23.2987 37.5603 26.3406 34.6424L24.6432 32.87ZM34.2615 27.8833C30.5119 28.5008 27.3275 30.294 24.6432 32.8691L26.3406 34.6415C28.7268 32.3526 31.4743 30.8294 34.6597 30.3054L34.2615 27.8823V27.8833ZM50.5118 32.1873C45.7715 28.0476 40.2161 26.9041 34.2615 27.8842L34.6597 30.3073C40.0123 29.4262 44.795 30.4536 48.8984 34.0381L50.5108 32.1883L50.5118 32.1873ZM56.7739 42.1164C55.8351 38.0522 53.5358 34.8266 50.5118 32.1864L48.8993 34.0362C51.6355 36.4252 53.5886 39.225 54.384 42.6698L56.7739 42.1164ZM53.5452 58.5327C57.2938 53.5639 58.1288 47.9813 56.7739 42.1174L54.384 42.6707C55.5983 47.9237 54.8426 52.7395 51.5874 57.054L53.5452 58.5336V58.5327ZM49.2522 62.7612C50.8647 61.5563 52.3158 60.1616 53.5452 58.5318L51.5874 57.0521C50.5137 58.476 49.2343 59.7102 47.785 60.7933L49.2522 62.7602V62.7612ZM32.7358 82.1708C32.5528 82.0755 32.4056 81.9943 32.1707 81.8687L31.0205 84.0377C31.2083 84.1368 31.4187 84.252 31.5979 84.3455L32.7358 82.1708ZM48.9786 90.6807C43.5665 87.8394 38.1498 85.0065 32.7368 82.1708L31.5989 84.3465C37.0138 87.1831 42.4286 90.015 47.8388 92.8554L48.9786 90.6816V90.6807ZM54.0943 92.4918C52.3243 92.201 50.6363 91.5513 48.9786 90.6807L47.8388 92.8544C49.6551 93.8081 51.5959 94.5692 53.6971 94.9139L54.0943 92.4909V92.4918ZM68.8369 88.2057C64.726 92.0829 59.7394 93.4182 54.0943 92.4918L53.6971 94.9148C60.0253 95.9545 65.8025 94.4427 70.5201 89.9933L68.8378 88.2067L68.8369 88.2057ZM73.6054 71.7942C75.2019 78.186 73.6036 83.711 68.8378 88.2057L70.5201 89.9923C75.9378 84.8819 77.7947 78.4438 75.985 71.1993L73.6054 71.7942ZM65.5779 61.4977C69.7059 63.8301 72.4657 67.2333 73.6054 71.7951L75.985 71.2002C74.6688 65.9292 71.4457 61.9944 66.7838 59.3608L65.5779 61.4987V61.4977ZM58.5647 57.7962C60.9547 59.0539 63.2861 60.2031 65.5779 61.4977L66.7838 59.3599C64.4533 58.0436 62.0171 56.8396 59.7064 55.6234L58.5647 57.7962ZM57.9033 57.4033C58.0949 57.5185 58.3496 57.6828 58.5647 57.7962L59.7064 55.6234C59.5687 55.5507 59.4903 55.4931 59.1648 55.2976L57.9033 57.4033ZM59.346 55.0228C59.0658 55.0493 58.7657 55.088 58.3959 55.1305L58.6733 57.5695C59.0969 57.5214 59.3262 57.4902 59.5772 57.4666L59.346 55.0228ZM67.7726 51.8585C65.3421 53.7291 62.4841 54.7263 59.346 55.0238L59.5772 57.4676C63.0984 57.1342 66.4139 56.0011 69.2681 53.8047L67.7726 51.8585ZM74.3461 35.1287C74.9896 38.6216 74.7141 41.7293 73.6196 44.4771C72.5242 47.2287 70.5805 49.6961 67.7716 51.8576L69.2671 53.8038C72.3609 51.4223 74.6131 48.6159 75.8982 45.3855C77.1852 42.1523 77.4739 38.5688 76.7578 34.683L74.3452 35.1287H74.3461ZM66.1894 23.8984C70.6211 26.3913 73.4271 30.1439 74.3461 35.1297L76.7587 34.684C75.7001 28.9409 72.4213 24.5877 67.3914 21.7577L66.1894 23.8975V23.8984ZM54.2142 17.5869C58.2553 19.7068 62.2681 21.6926 66.1894 23.8984L67.3914 21.7587C63.4296 19.5302 59.3252 17.4962 55.353 15.4131L54.2142 17.5878V17.5869ZM43.1514 11.7852C46.8396 13.7182 50.5269 15.652 54.2142 17.5859L55.353 15.4112C51.6657 13.4774 47.9775 11.5425 44.2893 9.60959L43.1514 11.7843V11.7852ZM27.5747 3.6087C32.7471 6.37921 37.9714 9.07041 43.1514 11.7852L44.2893 9.61054C39.0876 6.8844 33.8916 4.20831 28.7315 1.44441L27.5738 3.6087H27.5747ZM16.7695 1.34054C20.588 0.901449 24.1318 1.76452 27.5747 3.6087L28.7325 1.44441C24.9319 -0.591457 20.889 -1.60372 16.4893 -1.09853L16.7695 1.34054ZM7.16636 5.69555C9.86861 3.19982 13.0832 1.76452 16.7686 1.34054L16.4884 -1.09853C12.3057 -0.617897 8.60146 1.02893 5.50199 3.89104L7.16541 5.69555H7.16636ZM1.79394 17.1865C1.93641 12.6322 3.80081 8.80412 7.1673 5.69555L5.50387 3.89104C1.68827 7.41414 -0.494101 11.8504 -0.658274 17.1091L1.79394 17.1855V17.1865ZM9.67896 32.0702C4.2688 28.5924 1.59108 23.635 1.793 17.1865L-0.659217 17.11C-0.888493 24.4414 2.23457 30.2024 8.35237 34.1363L9.67801 32.0702H9.67896ZM16.8167 35.8946C14.2975 34.5565 11.9179 33.5084 9.67896 32.0693L8.35331 34.1354C10.6989 35.6434 13.3568 36.8369 15.6666 38.0636L16.8167 35.8946ZM18.064 36.5678C17.5885 36.311 17.1998 36.0985 16.8158 35.8946L15.6656 38.0636C16.0402 38.2628 16.4053 38.462 16.8979 38.7293L18.0631 36.5688L18.064 36.5678ZM15.9543 39.0333C16.4336 38.9597 16.8611 38.9427 17.6017 38.87L17.363 36.4262C16.7771 36.4838 16.1459 36.5197 15.5835 36.6056L15.9543 39.0324V39.0333ZM4.13576 46.2656C7.00218 42.1287 10.9669 39.7973 15.9543 39.0333L15.5835 36.6065C9.979 37.4639 5.3982 40.1363 2.1204 44.8661L4.13671 46.2656H4.13576ZM1.23915 54.9256C1.36653 51.765 2.33269 48.8671 4.13576 46.2646L2.11946 44.8652C0.0503114 47.8529 -1.06588 51.2023 -1.21212 54.8273L1.23915 54.9265V54.9256ZM3.96404 64.7083C2.01944 61.7244 1.09668 58.4666 1.23915 54.9256L-1.21212 54.8264C-1.37629 58.8906 -0.305396 62.6498 1.90905 66.0492L3.96404 64.7083ZM9.61197 70.0255C7.30034 68.7677 5.43028 66.9585 3.96499 64.7083L1.90999 66.0492C3.57437 68.6034 5.73409 70.7092 8.44011 72.1823L9.61197 70.0255ZM21.3626 76.2002C17.4196 74.1341 13.4927 72.1369 9.61197 70.0255L8.44011 72.1823C12.3425 74.3059 16.3185 76.3276 20.2247 78.3748L21.3626 76.2002ZM32.165 81.8658C28.5447 79.9678 24.9536 78.0821 21.3626 76.2002L20.2247 78.3748C23.8158 80.2568 27.404 82.1406 31.0271 84.0396L32.1659 81.8649L32.165 81.8658ZM48.5191 61.7782L49.2409 62.7706L49.2465 62.7659L49.2522 62.7612L48.5181 61.7772L48.5191 61.7782ZM58.5336 56.3505L58.3949 55.1305L54.8001 55.5403L57.9033 57.4024L58.5346 56.3495L58.5336 56.3505ZM17.4819 37.6481L17.6008 38.87L21.6023 38.479L18.064 36.5678L17.4819 37.6481ZM31.596 82.9527L32.1707 81.8687L32.1678 81.8668L32.165 81.8649L31.596 82.9527Z"
                fill="#363088"
              />
            </g>
          </svg>
        </Link>

        <Link to="/" className="flex gap-2 items-center ">
          <div className="">رجوع للصفحة الرئيسية</div>
          <svg
            width="46"
            height="46"
            viewBox="0 0 46 46"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M23.0007 42.1668C33.5861 42.1668 42.1673 33.5856 42.1673 23.0002C42.1673 12.4147 33.5861 3.8335 23.0007 3.8335C12.4152 3.8335 3.83398 12.4147 3.83398 23.0002C3.83398 33.5856 12.4152 42.1668 23.0007 42.1668Z"
              stroke="#363088"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M23 30.6668L30.6667 23.0002L23 15.3335"
              stroke="#363088"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M15.334 23H30.6673"
              stroke="#363088"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </Link>
      </div>
      <div className="flex flex-col items-center justify-center">
        <div className=" font-bold  text-[46px] w-[326px] h-[87px]  text-black">
          تسجيل الدخول
        </div>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(handleFormSubmit)} className="">
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  {/* <FormLabel>email</FormLabel> */}
                  <FormControl>
                    <IconInput
                      placeholder="الايميل"
                      className=""
                      inputClassName="w-[418px] h-[56px]"
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="business_reference"
              render={({ field }) => (
                <FormItem>
                  {/* <FormLabel>business_reference</FormLabel> */}
                  <FormControl>
                    <IconInput
                      placeholder="الرقم التعريفي"
                      className=" my-md"
                      inputClassName="w-[418px] h-[56px]"
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  {/* <FormLabel>password</FormLabel> */}
                  <FormControl>
                    <div className="relative">
                      <IconInput
                        placeholder="كلمة المرور"
                        className=""
                        inputClassName="w-[418px] h-[56px]"
                        {...field}
                        type={showPassword ? 'text' : 'password'}
                      />
                      <Button
                        type="button"
                        size="icon"
                        variant="ghost"
                        className="absolute right-1 top-[50%] bottom-[50%] left-[16px] h-6 w-6 -translate-y-1/2 rounded-md text-muted-foreground"
                        onClick={() => setShowPassword((prev) => !prev)}
                      >
                        {showPassword ? (
                          <IconEye size={18} />
                        ) : (
                          <IconEyeOff size={18} />
                        )}
                      </Button>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className=" text-sm text-main cursor-pointer mt-[10px] text-end">
              هل نسيت كلمة المرور؟
            </div>
            <div className=" mb-[20px] mt-[40px] ">
              <Button
                loading={isLoading}
                disabled={isLoading}
                type="submit"
                className="w-[418px] h-[56px]"
              >
                تسجيل الدخول
              </Button>
            </div>
            <div className="  ">
              <Button
                variant={'outline'}
                loading={false}
                type="submit"
                className="w-[418px] h-[56px]"
              >
                تسجيل الدخول
              </Button>
            </div>
          </form>
        </Form>
      </div>
    </div>
  );
}
